<!DOCTYPE html>
<html lang="en">

<head>
    <title>task 41.10 Filter Users</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Import Datatable sau jquery -->
    <!-- Import them style bootstrap cho datatable -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>
</head>
<style>
    .btn-edit,
    .btn-delete {
        padding: 10px 20px;
        margin: 5px;
    }
</style>

<body>
    <div class="container">
        <h2 style="text-align: center;">Danh sách đơn hàng</h2>

        <div class="row jumbotron">
            <div class="col-2">
                <label class="form-label">Loại pizza</label>
            </div>
            <div class="col-3">
                <select class="form-control" name="" id="type-pizza-select">

                    <option value="null">All</option>
                    <option value="Seafood">Hải sản</option>
                    <option value="Hawaii">Hawaii</option>
                    <option value="Bacon">Thịt hun khói</option>
                </select>
            </div>
            <div class="col-2">
                <label class="form-label">Trạng thái order</label>
            </div>
            <div class="col-3">
                <select class="form-control" name="" id="stutas-order-select">
                    <option value="null">All</option>
                    <option value="open">Open</option>
                    <option value="confirmed">Confirmed</option>
                    <option value="cancel">Cancel</option>
                </select>
            </div>
            <div class="col-2">
                <button id="btn-filter" class="btn btn-success">Lọc</button>
            </div>
        </div>
        <button class="btn btn-success form-group" id="btn-add-order" data-toggle="modal"
            data-target="#insert-user-modal">Thêm đơn hàng</button>
        <table class="table table-bordered table-striped table-hover" id="order-table">
            <thead>
                <tr>
                    <th>Order Code</th>
                    <th>Kích cỡ compo</th>
                    <th>Loại Pizza</th>
                    <th>Nước uống</th>
                    <th>Thành tiền</th>
                    <th>Họ và tên</th>
                    <th>Số điện thoại</th>
                    <th>Trạng thái</th>
                    <th>Action</th>
                </tr>
        </table>
    </div>

    <!-- modal add order -->
    <div id="add-order-modal" class="modal fade text-center" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content" style="width: 800px;">
                <div class="modal-header">
                    <h5 class="modal-title">Order Detail</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body - chứa form dữ liệu -->
                <div class="modal-body text-left">

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Pizza Size</label>
                        </div>
                        <div class="col-md-10">
                            <select id="select-pizzasize" class="form-control" type="text">
                                <option value="null">Chọn pizza size</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Đường kính(cm)</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-duongkinh" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Sườn</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-suon" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Salad(gram)</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-salad" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Số lượng nước uống</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-soluongdrink" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Thành tiền(VND)</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-thanhtien" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Pizza Type</label>
                        </div>

                        <div class="col-md-10">
                            <select id="input-pizzatype" class="form-control" type="text">
                                <option value="null">Chọn loại pizza</option>
                                <option value="Seafood">Hải sản</option>
                                <option value="Hawaii">Hawaii</option>
                                <option value="Bacon">Thịt hun khói</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">ID Voucher</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-idvoucher" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Loại đồ uống</label>
                        </div>
                        <div class="col-md-10">
                            <select name="" id="select-drink" class="form-control" type="select">
                                <option value="null">Chọn loại đồ uống</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Họ và tên</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-fullname" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Email</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-email" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Số điện thoại</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-phone" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Địa chỉ</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-address" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Lời nhắn</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-messeage" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Trạng thái</label>
                        </div>
                        <div class="col-md-10">
                            <input id="input-status" class="form-control" type="text" disabled>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-create-order" class="btn btn-success">Tạo đơn</button>
                    <button type="button" id="btn-modal-close" class=" btn btn-secondary"
                        data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modal update order -->
    <div id="update-order-modal" class="modal fade text-center" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content" style="width: 800px;">
                <div class="modal-header">
                    <h5 class="modal-title">Order Detail</h5>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <!-- Modal body - chứa form dữ liệu -->
                <div class="modal-body text-left">
                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Pizza Size</label>
                        </div>
                        <div class="col-md-10">
                            <select id="update-select-pizzasize" class="form-control" type="text">
                                <option value="null">Chọn pizza size</option>
                                <option value="s">S</option>
                                <option value="m">M</option>
                                <option value="l">L</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Đường kính(cm)</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-duongkinh" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Sườn</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-suon" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Salad(gram)</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-salad" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Số lượng nước uống</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-soluongdrink" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Thành tiền(VND)</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-thanhtien" class="form-control" type="text" disabled>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Pizza Type</label>
                        </div>

                        <div class="col-md-10">
                            <select id="update-input-pizzatype" class="form-control" type="text">
                                <option value="null">Chọn loại pizza</option>
                                <option value="Seafood">Hải sản</option>
                                <option value="Hawaii">Hawaii</option>
                                <option value="Bacon">Thịt hun khói</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">ID Voucher</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-idvoucher" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Loại đồ uống</label>
                        </div>
                        <div class="col-md-10">
                            <select name="" id="update-select-drink" class="form-control" type="select">
                                <option value="null">Chọn loại đồ uống</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Họ và tên</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-fullname" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Email</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-email" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Số điện thoại</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-phone" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Địa chỉ</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-address" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Lời nhắn</label>
                        </div>
                        <div class="col-md-10">
                            <input id="update-input-messeage" class="form-control" type="text">
                        </div>
                    </div>

                    <div class="form-group row">
                        <div class="col-md-2">
                            <label for="">Trạng thái</label>
                        </div>
                        <div class="col-md-10">
                            <select name="" id="update-select-status" class="form-control" type="select">
                                <option value="null">Chọn trạng thái</option>
                                <option value="open">Open</option>
                                <option value="cancel">Đã hủy</option>
                                <option value="confirmed">Đã xác nhận</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="btn-update-order" class="btn btn-success">Cập nhật</button>
                    <button type="button" id="btn-update-modal-close" class=" btn btn-secondary"
                        data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete confirm modal -->

    <div class="modal fade" tabindex="-1" id="delete-confirm-modal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="h5-modal-title"> Delete User</h5>
                    <button class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <label>Bạn có chắc chắn muốn xóa user này không?</label>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="btn-confirm-delete-user">Confirm</button>
                    <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

</body>

<script>
    "use strict";
    $(document).ready(function () {
        /*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
        var gDataOrders = [];
        var gIdUpdateOrder;
        var gIdDeleteOrder;
        var gThanhTien = 0;
        var gDiscount;
        var gFocus = 0;
        var gFocusUpdate = 0;
        var gPizzaSize = ["S", "M", "L"];
        const gBASE_URL = "http://203.171.20.210:8080/devcamp-pizza365/orders";
        const gREQUEST_STATUS_OK = 200;
        const gCOLUMN_ORDER_CODE = 0;
        const gCOLUMN_KICH_CO = 1;
        const gCOLUMN_LOAI_PIZZA = 2;
        const gCOLUMN_ID_LOAI_NUOC_UONG = 3;
        const gCOLUMN_THANH_TIEN = 4;
        const gCOLUMN_HO_TEN = 5;
        const gCOLUMN_SO_DIEN_THOAI = 6;
        const gCOLUMN_TRANG_THAI = 7;
        const gCOLUMN_ACTION = 8;
        const gCOLUMN = ["orderCode", "kichCo", "loaiPizza", "idLoaiNuocUong", "thanhTien", "hoTen", "soDienThoai", "trangThai", "action"];
        // định nghĩa table  - chưa có data
        var gUserTable = $("#order-table").DataTable({
            // Khai báo các cột của datatable
            "columns": [
                { "data": gCOLUMN[gCOLUMN_ORDER_CODE] },
                { "data": gCOLUMN[gCOLUMN_KICH_CO] },
                { "data": gCOLUMN[gCOLUMN_LOAI_PIZZA] },
                { "data": gCOLUMN[gCOLUMN_ID_LOAI_NUOC_UONG] },
                { "data": gCOLUMN[gCOLUMN_THANH_TIEN] },
                { "data": gCOLUMN[gCOLUMN_HO_TEN] },
                { "data": gCOLUMN[gCOLUMN_SO_DIEN_THOAI] },
                { "data": gCOLUMN[gCOLUMN_TRANG_THAI] },
                { "data": gCOLUMN[gCOLUMN_ACTION] }
            ],
            // Ghi đè nội dung của cột action, chuyển thành button chi tiết
            "columnDefs": [
                {
                    "targets": gCOLUMN_ACTION,
                    "defaultContent": `
                <button class="btn btn-primary btn-edit">Sửa</button>
                <button class="btn btn-danger btn-delete" data-toggle='modal'>Xóa</button>
                `
                }]
        });

        /*** REGION 2 - Vùng gán / thực thi hàm xử lý sự kiện cho các elements */
        onPageLoading();
        // hàm hiển thị danh sách đồ uống

        $("#btn-filter").on('click', function () {
            onBtnFilterDataClick();
        });

        getDrinkListAjaxClick();
        // hàm hiện thị kích cỡ pizza
        getPizzaSizeList(gPizzaSize);

        // thêm đơn hàng
        $("#btn-add-order").on('click', function () {
            onBtnAddOrderUserClick();
        })
        // tạo đơn hàng
        $("#btn-create-order").on('click', function () {
            onBtnCreateOrderClick();
        })
        // sửa đơn hàng
        $("#order-table").on('click', ".btn-edit", function () {
            onBtnEditClick(this);
        });
        // cập nhật đơn hàng
        $("#btn-update-order").on('click', function () {
            onBtnUpdateOrder();
        })

        // xóa đơn hàng
        $("#order-table").on('click', ".btn-delete", function () {
            onBtnDeleteOrderClick(this);
        });
        // xác nhận xóa đơn
        $("#btn-confirm-delete-user").on('click', function () {
            onBtnConfirmDeleteOrderClick();
        })

        /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
        // hàm chạy khi trang được load
        function onPageLoading() {
            // lấy data từ server
            $.ajax({
                async: true,
                url: gBASE_URL,
                type: "GET",
                dataType: 'json',
                success: function (responseObject) {
                    //debugger;
                    gDataOrders = responseObject;
                    loadDataToOrderTable(responseObject);
                },
                error: function (error) {
                    console.assert(error.responseText);
                }
            });
        }

        function onBtnAddOrderUserClick() {
            $("#add-order-modal").modal("show");
            $("#input-status").val("Open");
            $("#select-pizzasize").change(function () {
                var vInputPizzaSize = $("#select-pizzasize").val();
                if (vInputPizzaSize === "s") {
                    $("#input-duongkinh").val(20);
                    $("#input-suon").val(2);
                    $("#input-salad").val(200);
                    $("#input-soluongdrink").val(2);
                    $("#input-thanhtien").val(150000);
                }
                else if (vInputPizzaSize === "m") {
                    $("#input-duongkinh").val(25);
                    $("#input-suon").val(4);
                    $("#input-salad").val(300);
                    $("#input-soluongdrink").val(3);
                    $("#input-thanhtien").val(200000);
                }
                else if (vInputPizzaSize === "l") {
                    $("#input-duongkinh").val(30);
                    $("#input-suon").val(8);
                    $("#input-salad").val(500);
                    $("#input-soluongdrink").val(4);
                    $("#input-thanhtien").val(250000);
                }
            })

            $("#input-idvoucher").focusout(function () {
                var vInputVoucher = $("#input-idvoucher").val();
                gFocus++;
                if (vInputVoucher == "") {
                    gFocus--;
                }
                if (gFocus <= 1) {
                    callApiToGetVoucherId(vInputVoucher);
                }
            })
        }

        function callApiToGetVoucherId(paramVoucher) {
            $.ajax({
                url: "http://203.171.20.210:8080/devcamp-pizza365/voucher_detail/" + paramVoucher,
                type: "GET",
                dataType: 'json',
                success: function(res) {
                    reloadPrice(res)
                },
                error: function(error) {
                    $("#input-thanhtien").val();
                    alert("Chưa nhập mã giảm giá hoặc mã giảm giá không tồn tại")
                }
            })
        }

        function reloadPrice(paramDiscount) {
            var resultCreateOrder = $("#input-thanhtien").val() * (1 - parseInt(paramDiscount.phanTramGiamGia) / 100);
            $("#input-thanhtien").val(resultCreateOrder);
        }


        function onBtnEditClick(paramButtonElement) {
            'use strict';
            console.log("%cButton Edit Click", "color:orange");
            var vRowClick = $(paramButtonElement).closest('tr'); // xác định tr chứa nút bấm được click
            var vTable = $("#order-table").DataTable(); // tạo biến truy xuất đến datatable
            var vDataRow = vTable.row(vRowClick).data(); // lấy dữ liệu của hàng dữ liệu chứ nút bấm được click
            callApiToGetDataOrder(vDataRow.orderCode)
        }

        // hàm xử lý sự kiện click icon delete 
        function onBtnDeleteOrderClick(paramButtonElement) {
            'use strict';
            console.log("%cIcon delete Click", "color:red");
            var vRowClick = $(paramButtonElement).closest('tr'); // xác định tr chứa nút bấm được click
            var vTable = $("#order-table").DataTable(); // tạo biến truy xuất đến datatable
            var vDataRow = vTable.row(vRowClick).data(); // lấy dữ liệu của hàng dữ liệu chứ nút bấm được click
            gIdDeleteOrder = vDataRow.id;
            $("#delete-confirm-modal").modal("show");
        }

        // hàm xử lý bấm nút tạo đơn
        function onBtnCreateOrderClick() {

            var vCreateOderObject = {
                kichCo: '',
                duongKinh: 0,
                suon: 0,
                salad: 0,
                soLuongNuoc: 0,
                thanhTien: 0,
                loaiPizza: '',
                idVourcher: 0,
                idLoaiNuocUong: '',
                hoTen: '',
                email: '',
                soDienThoai: '',
                diaChi: '',
                loiNhan: '',
                trangThai: '',
            }
            getDataToCreateOrder(vCreateOderObject);

            var isValidate = validateDate(vCreateOderObject);
            if (isValidate) {
                callApiToCreateOrder(vCreateOderObject)
            }
        }

        function onBtnUpdateOrder() {
            var vUpdateOrderObject = {
                kichCo: '',
                duongKinh: 0,
                suon: 0,
                salad: 0,
                soLuongNuoc: 0,
                thanhTien: 0,
                loaiPizza: '',
                idVourcher: 0,
                idLoaiNuocUong: '',
                hoTen: '',
                email: '',
                soDienThoai: '',
                diaChi: '',
                loiNhan: '',
                trangThai: '',
            }
            
            getDataToUpdateOrder(vUpdateOrderObject);
            callApiToGetUpdateVoucherId(vUpdateOrderObject.idVourcher);
            var isValidate = validateDateUpdate(vUpdateOrderObject);
            if (isValidate) {
                callApiToUpdateOrder(vUpdateOrderObject)
            }

        }

        function validateDateUpdate(paramOrder) {
            if (paramOrder.kichCo === "null" || paramOrder.kichCo == undefined) {
                alert("Chưa chọn pizza size");
                return false;
            } else if (paramOrder.loaiPizza === "null" || paramOrder.loaiPizza == undefined) {
                alert("Chưa chọn pizza type");
                return false;
            } else if (isNaN(paramOrder.idVourcher)) {
                alert("Voucher phải là số");
                return false;
            } else if (paramOrder.idLoaiNuocUong === "null" || paramOrder.idLoaiNuocUong == undefined) {
                alert("Chưa chọn loại nước uống");
                return false;
            }
            else if (paramOrder.hoTen === "") {
                alert("Chưa nhập họ tên");
                return false;
            } else if (isEmail(paramOrder.email)) {
                return false;
            } else if (paramOrder.soDienThoai === "") {
                alert("Chưa nhập số điện thoại");
                return false;
            } else if (isNaN(paramOrder.soDienThoai)) {
                alert("Số điện thoại phải là số")
                return false;
            } else if (paramOrder.diaChi === "") {
                alert("Chưa nhập địa chỉ")
                return false;
            } else if (paramOrder.trangThai === "null" || paramOrder.trangThai == undefined) {
                alert("Chưa cập nhật trạng thái")
                return false;
            } 
           
            return true;
        }
        function isEmail(paramEmail) {
            if (paramEmail === "") {
                return false;
            }
            if (!paramEmail.includes("@")) {
                alert("Email phải có kí tự @");
                return true;
            } else if (paramEmail.startsWith("@")) {
                alert("Email không bắt đầu bằng kí tự @");
                return true;
            } else if (paramEmail.endsWith("@")) {
                alert("Email không kết thúc bằng kí tự @");
                return true;
            }
            return false;
        }
        /*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình */
        // load data to table
        function loadDataToOrderTable(paramResponseObject) {
            'use strict';
            var vUserTable = $("#order-table").DataTable();
            // xóa toàn bộ dữ liệu đang có trong bảng
            vUserTable.clear();
            // cập nhật data cho bảng
            vUserTable.rows.add(paramResponseObject);
            // cập nhật lại giao diện hiển thị bảng
            vUserTable.draw();
        }


        // hàm xử lý lọc dữ liệu bảng
        function onBtnFilterDataClick() {
            'use strict';
            var vStatus = $("#stutas-order-select").val();
            var vPizzaType = $("#type-pizza-select").val();
            var vDataFilter = gDataOrders.filter(function (gDataOrders) {
                return (vStatus === "null" || vStatus.toUpperCase() === gDataOrders.trangThai.toUpperCase())
                    && (vPizzaType === "null" || vPizzaType.toUpperCase() === gDataOrders.loaiPizza.toUpperCase())
            });
            loadDataToOrderTable(vDataFilter);
        }

        function getDrinkListAjaxClick() {
            'use strict';
            $.ajax({
                url: "http://203.171.20.210:8080/devcamp-pizza365/drinks",
                type: "GET",
                dataType: "json",
                success: function (res) {
                    handleDrinkList(res);
                    handleDrinkListUpdate(res);
                },
                error: function (ajaxContext) {
                    alert(ajaxContext.responseText);
                }
            })
        }

        function handleDrinkList(paramDrink) {
            'use strict';
            $.each(paramDrink, function (i, item) {
                $("#select-drink").append($('<option>', {
                    text: item.tenNuocUong,
                    value: item.maNuocUong
                }))
            })
        }
        function handleDrinkListUpdate(paramDrink) {
            'use strict';
            $.each(paramDrink, function (i, item) {
                $("#update-select-drink").append($('<option>', {
                    text: item.tenNuocUong,
                    value: item.maNuocUong
                }))
            })
        }

        function getPizzaSizeList(paramPizza) {
            'use strict';
            $.each(paramPizza, function (i, item) {
                $("#select-pizzasize").append($('<option>', {
                    text: item,
                    value: item.toLowerCase()
                }))
            })
        }


        function getDataToCreateOrder(paramCreateOrder) {
            paramCreateOrder.kichCo = $("#select-pizzasize").val();
            paramCreateOrder.duongKinh = $("#input-duongkinh").val().trim();
            paramCreateOrder.suon = $("#input-suon").val().trim();
            paramCreateOrder.salad = $("#input-salad").val().trim();
            paramCreateOrder.soLuongNuoc = $("#input-soluongdrink").val().trim();
            paramCreateOrder.thanhTien = $("#input-thanhtien").val().trim();
            paramCreateOrder.loaiPizza = $("#input-pizzatype").val();
            paramCreateOrder.idVourcher = $("#input-idvoucher").val().trim();
            paramCreateOrder.idLoaiNuocUong = $("#select-drink").val().trim();
            paramCreateOrder.hoTen = $("#input-fullname").val().trim();
            paramCreateOrder.email = $("#input-email").val().trim();
            paramCreateOrder.soDienThoai = $("#input-phone").val().trim();
            paramCreateOrder.diaChi = $("#input-address").val().trim();
            paramCreateOrder.loiNhan = $("#input-messeage").val().trim();
            paramCreateOrder.trangThai = $("#input-status").val();
        }

        function validateDate(paramOrder) {
            if (paramOrder.kichCo === "null" || paramOrder.kichCo == undefined) {
                alert("Chưa chọn pizza size");
                return false;
            } else if (paramOrder.loaiPizza === "null" || paramOrder.loaiPizza == undefined) {
                alert("Chưa chọn pizza type");
                return false;
            } else if (isNaN(paramOrder.idVourcher)) {
                alert("Voucher phải là số");
                return false;
            } else if (paramOrder.idLoaiNuocUong === "null" || paramOrder.idLoaiNuocUong == undefined) {
                alert("Chưa chọn loại nước uống");
                return false;
            }
            else if (paramOrder.hoTen === "") {
                alert("Chưa nhập họ tên");
                return false;
            } else if (isEmail(paramOrder.email)) {
                return false;
            } else if (paramOrder.soDienThoai === "") {
                alert("Chưa nhập số điện thoại");
                return false;
            } else if (isNaN(paramOrder.soDienThoai)) {
                alert("Số điện thoại phải là số")
                return false;
            } else if (paramOrder.diaChi === "") {
                alert("Chưa nhập địa chỉ")
                return false;
            } else if (paramOrder.trangThai === "null" || paramOrder.trangThai == undefined) {
                alert("Chưa cập nhật trạng thái")
                return false;
            }
            return true;
        }
        function isEmail(paramEmail) {
            if (paramEmail === "") {
                return false;
            }
            if (!paramEmail.includes("@")) {
                alert("Email phải có kí tự @");
                return true;
            } else if (paramEmail.startsWith("@")) {
                alert("Email không bắt đầu bằng kí tự @");
                return true;
            } else if (paramEmail.endsWith("@")) {
                alert("Email không kết thúc bằng kí tự @");
                return true;
            }
            return false;
        }

        function callApiToCreateOrder(paramCreateOrder) {
            console.log("pass")
            $.ajax({
                url: gBASE_URL,
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(paramCreateOrder),
                success: function (res) {
                    alert("Tạo đơn hàng thành công");
                    location.reload();
                },
                error: function (ajaxContext) {
                    alert(ajaxContext.responseText);
                }
            })
        }

        function callApiToGetDataOrder(paramOrderCode) {
            $.ajax({
                url: gBASE_URL + "/" + paramOrderCode,
                type: "GET",
                contentType: "application/json",
                success: function (res) {
                    gIdUpdateOrder = res.id;
                    handleUpdateModal(res);
                },
                error: function (ajaxContext) {
                    alert(ajaxContext.responseText);
                }
            })
        }

        function handleUpdateModal(paramOrder) {
            $("#update-order-modal").modal('show');
            $("#update-select-pizzasize").val(paramOrder.kichCo)
            $("#update-input-duongkinh").val(paramOrder.duongKinh);
            $("#update-input-suon").val(paramOrder.suon);
            $("#update-input-salad").val(paramOrder.salad);
            $("#update-input-soluongdrink").val(paramOrder.soLuongNuoc);
            $("#update-input-thanhtien").val(paramOrder.thanhTien);
            if (paramOrder.kichCo.toLowerCase() == "s") {
                $("#update-select-pizzasize").val("s");
                $("#update-input-duongkinh").val(20);
                $("#update-input-suon").val(2);
                $("#update-input-salad").val(200);
                $("#update-input-soluongdrink").val(2);
                $("#update-input-thanhtien").val(150000);
            }
           
            $("#update-select-pizzasize").change(function () {
                var vInputPizzaSize = $("#update-select-pizzasize").val();
                if (vInputPizzaSize === "null") {
                    $("#update-input-duongkinh").val("");
                    $("#update-input-suon").val("");
                    $("#update-input-salad").val("");
                    $("#update-input-soluongdrink").val("");
                    $("#update-input-thanhtien").val("");
                }
                else if (vInputPizzaSize === "s") {
                    $("#update-input-duongkinh").val(20);
                    $("#update-input-suon").val(2);
                    $("#update-input-salad").val(200);
                    $("#update-input-soluongdrink").val(2);
                    $("#update-input-thanhtien").val(150000);
                }
                else if (vInputPizzaSize === "m") {
                    $("#update-input-duongkinh").val(25);
                    $("#update-input-suon").val(4);
                    $("#update-input-salad").val(300);
                    $("#update-input-soluongdrink").val(3);
                    $("#update-input-thanhtien").val(200000);
                }
                else if (vInputPizzaSize === "l") {
                    $("#update-input-duongkinh").val(30);
                    $("#update-input-suon").val(8);
                    $("#update-input-salad").val(500);
                    $("#update-input-soluongdrink").val(4);
                    $("#update-input-thanhtien").val(250000);
                }
            })
            $("#update-input-pizzatype").val(paramOrder.loaiPizza)
            $("#update-input-idvoucher").val(paramOrder.idVourcher)
            $("#update-select-drink").val(paramOrder.idLoaiNuocUong)
            $("#update-input-fullname").val(paramOrder.hoTen)
            $("#update-input-email").val(paramOrder.email)
            $("#update-input-phone").val(paramOrder.soDienThoai)
            $("#update-input-address").val(paramOrder.diaChi)
            $("#update-input-messeage").val(paramOrder.loiNhan)
            $("#update-select-status").val(paramOrder.trangThai)

           
        }

        function callApiToGetUpdateVoucherId(paramVoucher) {
            $.ajax({
                url: "http://203.171.20.210:8080/devcamp-pizza365/voucher_detail/" + paramVoucher,
                type: "GET",
                dataType: 'json',
                success: function(res) {
                    reloadPriceUpdate(res)
                },
                error: function(error) {
                    $("#update-input-idvoucher").val();
                    $("#update-input-idvoucher").val("");
                    alert("Chưa nhập mã giảm giá hoặc mã giảm giá không tồn tại")
                }
            })
        }

        function reloadPriceUpdate(paramVoucher) {
            var resultUpdateOrder = $("#update-input-thanhtien").val() * (1 - parseInt(paramVoucher.phanTramGiamGia) / 100);
            $("#update-input-thanhtien").val(resultUpdateOrder);
        }

        function getDataToUpdateOrder(paramUpdateOrder) {
            paramUpdateOrder.kichCo = $("#update-select-pizzasize").val();
            paramUpdateOrder.duongKinh = $("#update-input-duongkinh").val();
            paramUpdateOrder.suon = $("#update-input-suon").val();
            paramUpdateOrder.salad = $("#update-input-salad").val();
            paramUpdateOrder.soLuongNuoc = $("#update-input-soluongdrink").val();
            paramUpdateOrder.thanhTien = $("#update-input-thanhtien").val();
            paramUpdateOrder.loaiPizza = $("#update-input-pizzatype").val();
            paramUpdateOrder.idVourcher = $("#update-input-idvoucher").val().trim();
            paramUpdateOrder.idLoaiNuocUong = $("#update-select-drink").val();
            paramUpdateOrder.hoTen = $("#update-input-fullname").val().trim();
            paramUpdateOrder.email = $("#update-input-email").val().trim();
            paramUpdateOrder.soDienThoai = $("#update-input-phone").val().trim();
            paramUpdateOrder.diaChi = $("#update-input-address").val().trim();
            paramUpdateOrder.loiNhan = $("#update-input-messeage").val().trim();
            paramUpdateOrder.trangThai = $("#update-select-status").val();
        }

        function callApiToUpdateOrder(paramUpdateOrder) {
            $.ajax({
                url: gBASE_URL + "/" + gIdUpdateOrder,
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify(paramUpdateOrder),
                success: function (res) {
                    alert("Cập nhật đơn hàng thành công");
                    location.reload();
                },
                error: function (ajaxContext) {
                    alert(ajaxContext.responseText);
                }
            })
        }
        function onBtnConfirmDeleteOrderClick() {
            $.ajax({
                url: gBASE_URL + "/" + gIdDeleteOrder,
                type: "DELETE",
                contentType: "application/json",
                success: function (res) {
                    alert("Xóa đơn hàng thành công");
                    location.reload();
                },
                error: function (ajaxContext) {
                    alert(ajaxContext.responseText);
                }
            })
        }
    });
</script>

</html>