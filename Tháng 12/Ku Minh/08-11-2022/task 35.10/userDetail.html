<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>userDetail</title>
    <!-- Nhúng thư viện bootstrap -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>

</head>
<body onload="onPageLoading()">
    <div class="contaier jumbotron w-50 m-auto">
        <div class="row form-group">
            <div class="col-sm-12 text-center">
                <!-- row 1 -->
                <h3>Chi tiết User</h3>
                <a id="input-id"></a>
            </div>
        </div>   

        <div class="row form-group">
            <!-- row 2 -->
            <div class="col-sm-3">
                <!-- row 2.1 -->
                <label for="">Name</label>
            </div>
            <div class="col-sm-9">
                <!-- row 2.2 -->
                <input type="text" id="input-name" class="form-control">
                </div>
        </div>   

        <div class="row form-group">
            <!-- row 3 -->
            <div class="col-sm-3">
                <!-- row 3.1 -->
                <label for="">User Name: </label>
            </div>
            <div class="col-sm-9">
                <!-- col 3.2 -->
                <input type="text" id="input-user-name" class="form-control">
            </div>
        </div>

        <div class="row form-group">
            <!-- row 4 -->
            <div class="col-sm-3">
                <!-- row 4.1 -->
                <label for="">Email: </label>
            </div>
            <div class="col-sm-9">
                <!-- col 4.2 -->
                <input type="text" id="input-email" class="form-control">
            </div>
        </div>

        <div class="row form-group">
            <!-- row 5 -->
            <div class="col-sm-3">
                <!-- col 5.1 -->
                <label for="">Address: </label>
            </div>
            <div class="col-sm-9">
                <!-- col 5.2 -->
                <div class="row form-group">
                    <div class="col-sm-2">
                        <!-- col 5.2.1.1 -->
                        <label for="">Suite:</label>
                    </div>
                    <div class="col-sm-10">
                        <!-- col 5.2.1.2 -->
                        <input type="text" id="input-suite" class="form-control">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-sm-2">
                        <!-- col 5.2.2.1 -->
                        <label for="">Street:</label>
                    </div>
                    <div class="col-sm-10">
                        <!-- col 5.2.2.2 -->
                        <input type="text" class="form-control" id="input-street">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-sm-2">
                        <!-- col 5.2.3.1 -->
                        <label for="">City:</label>
                    </div>
                    <div class="col-sm-10">
                        <!-- col 5.2.3.2 -->
                        <input id="input-city" type="text" class="form-control">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-sm-2">
                        <!-- col 5.2.4.1 -->
                        <label for="">Zipcode:</label>
                    </div>
                    <div class="col-sm-10">
                        <!-- col 5.2.4.2 -->
                        <input type="text" id="input-zipcode" class="form-control">
                    </div>
                </div>
                <div class="row form-group">
                    <!-- col 5.2.5 -->
                    <div class="col-sm-2">
                        <!-- col 5.2.5.1 -->
                        <label for="">Geo</label>
                    </div>
                    <div class="col-sm-10">
                        <!-- col 5.2.5.2 -->
                        <div class="row form-group">
                            <div class="col-sm-2">
                                <label for="">Lat:</label>
                            </div>
                            <div class="col-sm-10">
                                <input type="text" id="input-lat" class="form-control">
                            </div>
                        </div>
                        <div class="row form-group">
                            <div class="col-sm-2">
                                <label for="">Lng:</label>
                            </div>
                            <div class="col-sm-10">
                                <input type="text" id="input-lng" class="form-control">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row form-group">
            <!-- row 6 -->
            <div class="col-sm-3">
                <label for="">Phone:</label>
            </div>
            <div class="col-sm-9">
                <input type="text" id="input-phone" class="form-control">
            </div>
        </div>
        <div class="row form-group">
            <!-- row 7 -->
            <div class="col-sm-3">
                <label for="">Website:</label>
            </div>
            <div class="col-sm-9">
                <input type="text" id="input-website" class="form-control">
            </div>
        </div>
        <div class="row form-group">
            <!-- row 8 -->
            <div class="col-sm-3">
                <!-- col 8.1 -->
                <label for="">Company:</label>
            </div>
            <div class="col-sm-9">
                <!-- col 8.2 -->
                <div class="row form-group">
                    <div class="col-sm-3">
                        <label for="">Name:</label>
                    </div>
                    <div class="col-sm-9">
                        <input type="text" id="input-company-name" class="form-control">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-sm-3">
                        <label for="">Catch Phrase:</label>
                    </div>
                    <div class="col-sm-9">
                        <input type="text" id="input-catchPhrase" class="form-control">
                    </div>
                </div>
                <div class="row form-group">
                    <div class="col-sm-3">
                        <label for="">Bs:</label>
                    </div>
                    <div class="col-sm-9">
                        <input type="text" id="input-bs" class="form-control">
                    </div>
                </div>
            </div>
        </div>

        <div class="row form-group">
            <!-- row 9 -->
            <div class="col-sm-12" style="text-align: right;">
                <button id="btn-update" class="btn btn-success w-25">Update</button>
                <button id="btn-back" class="btn btn-primary w-25">Quay lại</button>
            </div>
        </div>
    </div>
</body>
<script>
    'use strict';
    /*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
    var gUserID;
    const V_HOME_URL = "task 35.10.html";
    /*** REGION 2 - Vùng gán / thực thi sự kiện cho các elements */
    $('#btn-back').on('click', function() {
        window.location.href = V_HOME_URL;
    });
    $('#btn-update').on('click', onBtnUpdateClick);
    /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
    function onPageLoading() {
        'use strict';
        // get data from query string
        var vUrlString = window.location.href;
        var vUrl = new URL(vUrlString);
        // get parameters
        // b1: thu thập dữ liệu id
        gUserID = vUrl.searchParams.get('id');
        // b2: validate
        var vIsVali = validateData(gUserID)
        if(vIsVali) {
            // b3: khi dữ liệu hợp lệ, call api sever get user data
            $.ajax({
                url: "https://jsonplaceholder.typicode.com/users/" + gUserID,
                type: "GET",
                dataType: "json",
                success: function(dataUsersObj) {
                    console.log(dataUsersObj);
                    // b4: đổ dữ liệu vào form
                    showDataOnForm(dataUsersObj);
                },
                error: function(ajaxContext) {
                    alert(ajaxContext.responseText)
                }
            });
        }
    }
    /*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
    // hàm kiểm tra dữ liệu
    function validateData(paramIdDetail) {
        if(paramIdDetail === "" || paramIdDetail === null) {
            alert('Không có id');
            return false;
        }
        return true;
    }
    // hàm show data lên form
    function showDataOnForm(paramDataUserObj) {
        $("#input-id").html("ID: " + paramDataUserObj.id);
        $("#input-name").val(paramDataUserObj.name);
        $("#input-user-name").val(paramDataUserObj.username);

        $("#input-email").val(paramDataUserObj.email);
        $("#input-suite").val(paramDataUserObj.address.suite);
        $("#input-street").val(paramDataUserObj.address.street);

        $("#input-city").val(paramDataUserObj.address.city);
        $("#input-zipcode").val(paramDataUserObj.address.zipcode);
        $("#input-lat").val(paramDataUserObj.address.geo.lat);

        $("#input-lng").val(paramDataUserObj.address.geo.lng);
        $("#input-phone").val(paramDataUserObj.phone);
        $("#input-website").val(paramDataUserObj.website);

        $("#input-company-name").val(paramDataUserObj.company.name);
        $("#input-catchPhrase").val(paramDataUserObj.company.catchPhrase);
        $("#input-bs").val(paramDataUserObj.company.bs);
    }
    function onBtnUpdateClick() {
        console.log("Ấn nút update");
        // thu thập dữ liệu
        var vObjectRequestData = {
            id: "",
            name: "",
            username: "",
            email: "",
            address: {
                street: "",
                suite: "",
                city: "",
                zipcode: "",
                geo: {
                    lat: "",
                    lng: ""
                }
            },
            phone: "",
            website: "",
            company: {
                name: "",
                catchPhrase: "",
                bs: ""
            }
        };
        getData(vObjectRequestData);
       console.log(vObjectRequestData);
        var vIsVali = validateDataObj(vObjectRequestData);
        if(vIsVali) {
            $.ajax({
                url: "https://jsonplaceholder.typicode.com/users/" + gUserID,
                type: 'PUT',
                contentType: 'application/json',
                data: JSON.stringify(vObjectRequestData),
                success: function (res) {
                    console.log(res);
                    alert('Cập nhật thành công');
                    window.location.href = V_HOME_URL;
                },
                error: function (ajaxContext) {
                    alert(ajaxContext.responseText)
                }
            });
        }
    }
    // hàm xử lý thu thập dữ liệu
    function getData(paramDataUserObj) {
        
        paramDataUserObj.id = gUserID;
        paramDataUserObj.name =  $("#input-name").val().trim();
        paramDataUserObj.username = $("#input-user-name").val().trim();

        paramDataUserObj.email = $("#input-email").val().trim();
        paramDataUserObj.address.street = $("#input-suite").val().trim();
        paramDataUserObj.address.suite = $("#input-street").val().trim();

        paramDataUserObj.address.city =  $("#input-city").val().trim();
        paramDataUserObj.address.zipcode = $("#input-zipcode").val().trim();
        paramDataUserObj.address.geo.lat = $("#input-lat").val().trim();

        paramDataUserObj.address.geo.lng = $("#input-lng").val().trim();
        paramDataUserObj.phone =  $("#input-phone").val().trim();
        paramDataUserObj.website = $("#input-website").val().trim();

        paramDataUserObj.company.name = $("#input-company-name").val().trim();
        paramDataUserObj.company.catchPhrase = $("#input-catchPhrase").val().trim();
        paramDataUserObj.company.bs = $("#input-bs").val().trim();
    }
    // hàm kiểm tra thông tin
    function validateDataObj(paramDataUserObj) {
        if(paramDataUserObj.name === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.username === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.email === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }

        if(paramDataUserObj.address.street  === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.address.suite === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.address.city === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }

        if(paramDataUserObj.address.zipcode === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.address.geo.lat === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.address.geo.lng === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }

        if(paramDataUserObj.phone === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.website === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.company.name === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.company.catchPhrase === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        if(paramDataUserObj.company.bs === "") {
            alert('Chưa điều đủ thông tin, vui lòng kiểm tra lại');
            return false
        }
        return true;
    }
</script>
</html>