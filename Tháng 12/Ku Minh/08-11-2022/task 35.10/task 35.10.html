<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <title>Document</title>
</head>
<body>
    <div class="container-fluid">
        <h1 class="text-center">DANH SÁCH NGƯỜI DÙNG</h1>
        
        <div class="row form-group">
            <div class="col-sm-2 text-right">              
                <label for="" >Name:</label>
            </div>
            <div class="col-sm-6">    
                <input type="text" id="input-name" class="form-control">
            </div>
            <div class="col-sm-2">       
                <button class="btn btn-success" id="btn-filter">Lọc Users</button>
            </div> 
        </div> 
        <div class="row">
            <div class="col-sm-12 text-nowrap">
                <table class="table table-bordered table-striped table-hover" id="table-users">
                    <thead class="text-white thead-dark">
                        <tr class="text center">
                            <th scope="col">STT</th>
                            <th scope="col">Name</th>
                            <th scope="col">Username</th>
                            <th scope="col">Email</th>
                            <th scope="col">Address</th>
                            <th scope="col">Zip code</th>
                            <th scope="col">Phone</th>
                            <th scope="col">Company</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>    
            </div>
        </div>
    </div>
</body>
<script>
    'use strict';
    /*** REGION 1 - Global variables - Vùng khai báo biến, hằng số, tham số TOÀN CỤC */
    var gData = [];
     
    /*** REGION 2 - Vùng gán / thực thi sự kiện cho các elements */
    onPageLoading();
    $(document).on('click', '.btn-detail', function() {
        console.log('Nút chi tiết được ấn');
        console.log('ID: ' + $(this).data('id'));
        const vDETAIL_FORM_URL = 'userDetail.html';
        var vUrlSiteToOpen = vDETAIL_FORM_URL + '?id=' + $(this).data('id');
        window.location.href = vUrlSiteToOpen;
    })

    $("#btn-filter").click(function() {
        var vFilterObj = {
            name: ''
        }
        readDataName(vFilterObj);
        var vArrUserFiltered = findUserByFilter(vFilterObj);
        if(vArrUserFiltered){
            var vTable = $('#table-users');
            vTable.find('tr:gt(0)').html('');
            if(vArrUserFiltered.length > 0) {
                alert(`Tìm thấy ${vArrUserFiltered.length} kết quả`)
                fillDataTableUser(vArrUserFiltered);
            } else {
                alert("Không tìm thấy kết quả phù hợp");
                return false;
            }
        }
    })
    /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
    // hàm xử lý khi load trang
    function onPageLoading() {
        $.ajax({
            url: 'https://jsonplaceholder.typicode.com/users',
            type: 'GET',
            dataType: 'json',
            success: function(paramRes) {
                gData = paramRes;
                showAllDataUsers(paramRes);
            },
            error: function(ajaxContext) {
                alert(ajaxContext.responseText)
            }
        });
        fillDataTableUser(gData);
    }
    /*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
    function showAllDataUsers(paramArray) {
        console.log(gData);     
        for(var bI = 0; bI < paramArray.length; bI ++) {
            var bRow = "";
            bRow += '<tr>';
            bRow += '<td>' + paramArray[bI].id + '</td>';
            bRow += '<td>' + paramArray[bI].name + '</td>';
            bRow += '<td>' + paramArray[bI].username + '</td>';
            
            bRow += '<td>' + paramArray[bI].email + '</td>';
            bRow += '<td>' + paramArray[bI].address.suite + ', ' + paramArray[bI].address.street + ', ' + paramArray[bI].address.city + '</td>';
            bRow += '<td>' + paramArray[bI].address.zipcode + '</td>';

            bRow += '<td>' + paramArray[bI].phone + '</td>';
            bRow += '<td>' + paramArray[bI].company.name + '</td>';
            bRow += '<td>' + "<button class='btn btn-success btn-detail' data-id='" + paramArray[bI].id +"'>Chi tiết</button>" + '</td>';

            bRow += '</tr>';

            $('#table-users tbody').append(bRow);
          
        } 
    }
    function readDataName(paramObjName) {
        paramObjName.name = $("#input-name").val().trim();
    }

    function findUserByFilter(paramKeyWordObj) {
        const vArrResultObj = [];
        if(paramKeyWordObj.name === "") {
            alert('Chưa điền thông tin');
            return false;
        }
        else {
            for(let bI = 0; bI < gData.length; bI ++) {
                const bItemUserObj = gData[bI];
                if(bItemUserObj.name.includes(paramKeyWordObj.name)){
                    vArrResultObj.push(bItemUserObj);
                }
            }
        }
        return vArrResultObj;
    }
</script>
</html>
