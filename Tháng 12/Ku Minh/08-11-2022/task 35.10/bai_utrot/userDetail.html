<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Detail</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body onload="onPageLoading()">
    <div class="container jumbotron">
        <div class="text-center mb-4">
            <h3>Chi tiết User</h3>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Name</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Name" id="input-name" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Username</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Username" id="input-username" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Email</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Email" id="input-email" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Suite</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Suite" id="input-suite" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Street</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Street" id="input-street" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">City</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="City" id="input-city" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Zip code</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Zip code" id="input-zipcode" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Geo lat</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Geo lat" id="input-geo-lat" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Geo lng</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Geo lng" id="input-geo-lng" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Phone</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Phone" id="input-phone" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Website</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Website" id="input-website" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Company Name</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Company Name" id="input-companyname" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Company catchPhrase</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Company catchPhrase" id="input-company-catchphrase" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                <label for="">Company bs</label>
            </div>
            <div class="col-sm-8">
                <input class="form-control" placeholder="Company bs" id="input-company-bs" type="text">
            </div>
        </div>
        <div class="row form-group">
            <div class="col-sm-4">
                
            </div>
            <div class="col-sm-8">
                <button type="button" class="btn btn-success w-25" id="btn-update-user">Update user</button>
                <button type="button" class="btn btn-success w-25" id="btn-huy">Hủy bỏ</button>
            </div>
        </div>
    </div>
</body>
<script>
    function onPageLoading() {
        var vUrlString = window.location.href;
        var vUrl = new URL(vUrlString);
        var vId = vUrl.searchParams.get("id");
        console.log(vId);
        callAPIGetDataUserById(vId);       
        }
    $("#btn-update-user").click(function(){
       console.log("Update user clicked....");
       var vDateObj =  {
                name: "",
                username: "",
                email: "",
                address: {
                    street: "",
                    suite: "",
                    city: "",
                    zipcode: "",
                    geo: {
                        lat: "",
                        lng: ""
                    }
                },
                phone: "",
                website: "",
                company: {
                    name: "",
                    catchPhrase: "",
                    bs: ""
                }
            };
        getFormData(vDateObj);    
        var vIsValidate = validateFormData(vDateObj);
        if(vIsValidate){
            callAjaxRestApiUpdate(vDateObj);
        } 
    })
    $("#btn-huy").click(function(){
       alert("Khi ấn nút Hủy thì quay lại trang list all users (35.10)");
       window.location.href = "Task 35.10.html" 
    })
    function callAPIGetDataUserById(paramUserId){
        $.ajax({
            url: "https://jsonplaceholder.typicode.com/users/" + paramUserId,
            type: "GET",
            dataType: "json",
            success: function(DataUserObj){
                console.log(DataUserObj);
                showDataUserToForm(DataUserObj);
            },
            error: function(ajaxContext){
                alert(ajaxContext.responseText);
            }
        })       
    } 
    function showDataUserToForm(paramUserObj){
        $("#input-name").val(paramUserObj.name);
        $("#input-username").val(paramUserObj.username);
        $("#input-email").val(paramUserObj.email);
        $("#input-suite").val(paramUserObj.address.suite);
        $("#input-street").val(paramUserObj.address.street);
        $("#input-city").val(paramUserObj.address.city);
        $("#input-zipcode").val(paramUserObj.address.zipcode);
        $("#input-geo-lat").val(paramUserObj.address.geo.lat);
        $("#input-geo-lng").val(paramUserObj.address.geo.lng);
        $("#input-phone").val(paramUserObj.phone);
        $("#input-website").val(paramUserObj.website);
        $("#input-companyname").val(paramUserObj.company.name);
        $("#input-company-catchphrase").val(paramUserObj.company.catchPhrase);
        $("#input-company-bs").val(paramUserObj.company.bs);
    }
    function getFormData(paramUserObj){
        

        paramUserObj.name = $("#input-name").val().trim();
        paramUserObj.username =  $("#input-username").val().trim();
        paramUserObj.email = $("#input-email").val().trim();
        paramUserObj.address.suite = $("#input-suite").val().trim();
        paramUserObj.address.street = $("#input-street").val().trim();
        paramUserObj.address.city = $("#input-city").val().trim();
        paramUserObj.address.zipcode = $("#input-zipcode").val().trim();
        paramUserObj.address.geo.lat = $("#input-geo-lat").val().trim();
        paramUserObj.address.geo.lng = $("#input-geo-lng").val().trim();
        paramUserObj.phone = $("#input-phone").val().trim();
        paramUserObj.website = $("#input-website").val().trim();
        paramUserObj.company.name = $("#input-companyname").val().trim();
        paramUserObj.company.catchPhrase = $("#input-company-catchphrase").val().trim();
        paramUserObj.company.bs =  $("#input-company-bs").val().trim();

        
    }
    function validateFormData(paramUserObj){
        if(paramUserObj.name == ""){
            alert("Hãy nhập name ");
            return false;
        }
        if(paramUserObj.username == ""){
            alert("Hãy nhập username ");
            return false;
        }
        if(paramUserObj.email == ""){
            alert("Hãy nhập email ");
            return false;
        }
        if(paramUserObj.address.suite == ""){
            alert("Hãy nhập suite ");
            return false;
        }
        if(paramUserObj.address.street == ""){
            alert("Hãy nhập street ");
            return false;
        }
        if(paramUserObj.address.city == ""){
            alert("Hãy nhập city ");
            return false;
        }
        if(paramUserObj.address.zipcode == ""){
            alert("Hãy nhập zipcode ");
            return false;
        }
        if(paramUserObj.address.geo.lat == ""){
            alert("Hãy nhập geo lat ");
            return false;
        }
        if(paramUserObj.address.geo.lng == ""){
            alert("Hãy nhập geo lng ");
            return false;
        }
        if(paramUserObj.phone == ""){
            alert("Hãy nhập phone ");
            return false;
        }
        if(paramUserObj.website == ""){
            alert("Hãy nhập website ");
            return false;
        }
        if(paramUserObj.company.name == ""){
            alert("Hãy nhập company name ");
            return false;
        }
        if(paramUserObj.company.catchPhrase == ""){
            alert("Hãy nhập company catchPhrase ");
            return false;
        }
        if(paramUserObj.company.bs == ""){
            alert("Hãy nhập company bs ");
            return false;
        }
        return true;
    } 
    function callAjaxRestApiUpdate(paramObj){
        "use strict";
      // 1. Đọc dữ liệu
      var vUrlString = window.location.href;
      var vUrl = new URL(vUrlString);
      var vId = vUrl.searchParams.get("id");
      var vUserId = vId;
      //data to be sent 
      var vObjectRequestData = paramObj;
      //2 . Kiểm tra
      //3. Gọi server  phải implement ajax put call tại đây (gọi rest API by Ajax)
      $.ajax({
        url:"https://jsonplaceholder.typicode.com/users/" + vUserId,
        type: "PUT",
        contentType: "application/json",
        data: JSON.stringify(vObjectRequestData),
        success: getUserByIdResponseProcess,
        error:getUserByIdError
      })  
    }
    function getUserByIdResponseProcess(paramObj){
        alert("Cập nhập thành công...");
        console.log(paramObj);
        console.log(Object.entries(paramObj));
        window.location.href = "Task 35.10.html"
    }
    function getUserByIdError(paramError){
        alert(paramError.responseText);
    }    
</script>
</html>