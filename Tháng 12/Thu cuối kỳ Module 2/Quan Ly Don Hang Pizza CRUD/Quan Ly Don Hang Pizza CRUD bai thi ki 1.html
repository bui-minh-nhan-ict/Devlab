<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Don Hang (CRUD)</title>

    <!-- font-awesome boostrap  -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <!-- Import Datatable sau jquery -->
    <!-- Import them style bootstrap cho datatable -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.24/css/dataTables.bootstrap4.min.css">
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/dataTables.bootstrap4.min.js"></script>

</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center" style="margin-top: 40px;">Quản lý Don Hang Pizza (CRUD)</h2>
            </div>
        </div>

        <div class="container">
            <div class="jumbotron container">
                <div class="row form-group">
                    <div class="col-sm-2 text-right">
                        <label class="col-form-label"> Loai Pizza</label>
                    </div>
                    <div class="col-sm-3">
                        <select id="select-type-pizza" class="form-control select-fillter">
                            <option value="0">--Chon Loai Pizza--</option>
                            <option value="Seafood">Hai san</option>
                            <option value="Hawaii">Hawaii</option>
                            <option value="Bacon">Thit hun khoi</option>
                        </select>
                    </div>
                    <div class="col-sm-2 text-right">
                        <label class="col-form-label"> Trang Thai Don Hang</label>
                    </div>
                    <div class="col-sm-3">
                        <select id="select-status" class="form-control select-fillter">
                            <option value="0">--Chon Trang Thai--</option>
                            <option value="open">Open</option>
                            <option value="cancel">Canceled</option>
                            <option value="confirmed">Confirmed</option>
                        </select>
                    </div>
                    <div class="col-sm-2">
                        <button id="btn-filter-order" class="btn-success ">Loc Du Lieu</button>
                    </div>
                </div>
            </div>

            <div class="btn-add">
                <button id="btn-add" class="btn btn-success"> <i class="fas fa-plus"></i> Them </button>
            </div>

            <div class="container-fluid">
                <table class="table table-bordered table-striped table-hover" id="table-order">
                    <thead>
                        <tr class="text-center">
                            <th>Order Code</th>
                            <th style="width: 60px;">Kick co combo</th>
                            <th style="width: 120px;">Loai pizza</th>
                            <th style="width: 120px;">Nuoc Uong</th>
                            <th style="width: 80px;">Thanh tien</th>
                            <th style="width: 180px;">Ho va ten</th>
                            <th style="width: 120px;">So dien thoai</th>
                            <th style="width: 80px;">Trang Thai</th>
                            <th style="width: 150px;">Action</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>

        <!-- Modal add-order-->
        <div id="modal-add-order" class="modal fade" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"> Add Order </h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <!-- Modal body - chứa form dữ liệu -->
                    <div class="modal-body">
                        <form>
                            <!-- form thiết kế như form bình thường, theo grid model -->
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Kick co</label>
                                <div class="col-sm-4">
                                    <select class="form-control" name="kich-co" id="select-size-add">
                                        <option value="0">--Chon size--</option>
                                        <option value="1">S</option>
                                        <option value="2">M</option>
                                        <option value="3">L</option>
                                    </select>
                                </div>

                                <div class="col-sm-6 form-group">
                                    <div class="row col-sm-12">
                                        <label class="col-sm-5 col-form-label">Duong Kinh</label>
                                        <div class="col-sm-7">
                                            <select class="form-control" name="duong-kinh" id="select-diameter-add">
                                                <option value="0">--Chon--</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row col-sm-12">
                                        <label class="col-sm-5 col-form-label">Suong nướng</label>
                                        <div class="col-sm-7">
                                            <select class="form-control" name="suon-nuong" id="select-suon-add">
                                                <option value="0">--Chon--</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row col-sm-12">
                                        <label class="col-sm-5 col-form-label">Salad</label>
                                        <div class="col-sm-7">
                                            <select class="form-control" name="salad" id="select-salad-add">
                                                <option value="0">--Chon--</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row col-sm-12">
                                        <label class="col-sm-5 col-form-label"> SL Nuoc Uong</label>
                                        <div class="col-sm-7">
                                            <select class="form-control" name="water" id="select-water-add">
                                                <option value="0">--Chon--</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row col-sm-12">
                                        <label class="col-sm-5 col-form-label"> Don gia</label>
                                        <div class="col-sm-7">
                                            <select class="form-control" name="kich-co" id="select-price-add">
                                                <option value="0">--Chon--</option>
                                            </select>
                                        </div>
                                    </div>

                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Loai Pizza</label>
                                <div class="col-sm-10">
                                    <select class="form-control" name="loai-banh" id="select-type-add">
                                        <option value="0">--Chon Loai Pizza--</option>
                                        <option value="Seafood">Hai san</option>
                                        <option value="Hawaii">Hawaii</option>
                                        <option value="Bacon">Thit hun khoi</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">ID Voucher</label>
                                <div class="col-sm-10">
                                    <input id="input-voucher-add" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Loai do Uong</label>
                                <div class="col-sm-10">
                                    <select class="form-control" name="loai-do-uong" id="select-type-water-add">
                                        <option value="0">--Chon Loai Nuoc Uong--</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Ho va ten</label>
                                <div class="col-sm-10">
                                    <input id="input-fullname-add" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Email</label>
                                <div class="col-sm-10">
                                    <input id="input-email-add" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">So dien thoai</label>
                                <div class="col-sm-10">
                                    <input id="input-mobile-add" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Dia Chi</label>
                                <div class="col-sm-10">
                                    <input id="input-address-add" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Loi Nhan</label>
                                <div class="col-sm-10">
                                    <input id="input-messeage-add" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-2 col-form-label">Trang Thai</label>
                                <div class="col-sm-10">
                                    <select id="select-status-add" class="form-control" name="trang-thai" disabled>
                                        <option value="open">Open</option>
                                        <option value="cancel">Da Huy</option>
                                        <option value="confirmed">Da xac nhan</option>
                                    </select>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <div class="row col-sm-12">
                            <div class="col-sm-6">
                                <button type="button" id="btn-modal-close" class="btn btn-block btn-dark"
                                    data-dismiss="modal">
                                    Close
                                </button>
                            </div>
                            <div class="col-sm-6">
                                <button type="button" id="btn-modal-add-order" class="btn btn-block btn-success">
                                    Add Order
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal detail order-->
        <div id="modal-detail-order" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"> Order Detail </h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <!-- Modal body - chứa form dữ liệu -->
                    <div class="modal-body">
                        <form>
                            <!-- form thiết kế như form bình thường, theo grid model -->
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Order Code </label>
                                <div class="col-sm-8">
                                    <input id="input-detail-order-code" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label"> Pizza Size</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-combo" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Duong Kinh</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-duong-kinh" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Suon </label>
                                <div class="col-sm-8">
                                    <input id="input-detail-suon-nuong" type="number" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Salad</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-salad" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">So Luong Nuoc Uong</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-drink-number" type="number" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Thanh tien</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-money" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Pizza Type</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-type-pizza" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">ID Voucher</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-voucher" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Giam gia</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-discoun" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Loai do Uong</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-drink" type="text" class="form-control">
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Ho va ten</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-full-name" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Email</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-email" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">So dien thoai</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-mobile" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Dia Chi</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-address" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Loi Nhan</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-messeage" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Ngay Tao Don</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-date-create" type="text" class="form-control">
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Ngay Chinh Sua</label>
                                <div class="col-sm-8">
                                    <input id="input-detail-date-update" type="text" class="form-control">
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="btn-modal-close" class="btn btn-block btn-dark" data-dismiss="modal">
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal update order-->
        <div id="modal-edit-order" class="modal fade" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"> Edit Order </h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <!-- Modal body - chứa form dữ liệu -->
                    <div class="modal-body">
                        <form>
                            <!-- form thiết kế như form bình thường, theo grid model -->
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Order Code </label>
                                <div class="col-sm-8">
                                    <input id="input-order-code" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label"> Pizza Size</label>
                                <div class="col-sm-8">
                                    <input id="input-combo" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Duong Kinh</label>
                                <div class="col-sm-8">
                                    <input id="input-duong-kinh" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Suon </label>
                                <div class="col-sm-8">
                                    <input id="input-suon-nuong" type="number" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Salad</label>
                                <div class="col-sm-8">
                                    <input id="input-salad" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">So Luong Nuoc Uong</label>
                                <div class="col-sm-8">
                                    <input id="input-drink-number" type="number" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Thanh tien</label>
                                <div class="col-sm-8">
                                    <input id="input-money" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Pizza Type</label>
                                <div class="col-sm-8">
                                    <input id="input-type-pizza" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">ID Voucher</label>
                                <div class="col-sm-8">
                                    <input id="input-voucher" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Giam gia</label>
                                <div class="col-sm-8">
                                    <input id="input-discoun" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Loai do Uong</label>
                                <div class="col-sm-8">
                                    <input id="input-drink" type="text" class="form-control" disabled>
                                </div>
                            </div>

                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Ho va ten</label>
                                <div class="col-sm-8">
                                    <input id="input-full-name" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Email</label>
                                <div class="col-sm-8">
                                    <input id="input-email" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">So dien thoai</label>
                                <div class="col-sm-8">
                                    <input id="input-mobile" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Dia Chi</label>
                                <div class="col-sm-8">
                                    <input id="input-address" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Loi Nhan</label>
                                <div class="col-sm-8">
                                    <input id="input-messeage" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Ngay Tao Don</label>
                                <div class="col-sm-8">
                                    <input id="input-date-create" type="text" class="form-control" disabled>
                                </div>
                            </div>
                            <div class="row form-group">
                                <label class="col-sm-4 col-form-label">Ngay Chinh Sua</label>
                                <div class="col-sm-8">
                                    <input id="input-date-update" type="text" class="form-control" disabled>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <div class="row col-sm-12">
                            <div class="col-sm-6">
                                <button type="button" id="btn-modal-cancel"
                                    class="btn btn-block btn-danger">Cancel</button>
                            </div>
                            <div class="col-sm-6">
                                <button type="button" id="btn-modal-confirm-order" class="btn btn-block btn-warning">
                                    Confirm
                                </button>
                            </div>
                        </div>
                        <div class="float-right">
                            <button type="button" id="btn-modal-close" class="btn btn-dark" data-dismiss="modal">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete confirm modal -->
        <div>
            <div id="delete-confirm-modal" class="modal fade" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="h5-modal-title">Order Delete Confirmation</h5>
                            <button class="close" data-dismiss="modal">&times;</button>
                        </div>
                        <div class="modal-body">
                            <label>Ban co chac muon Xoa Order nay khong?</label>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-danger" id="btn-confirm-delete-order">Confirm</button>
                            <button class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            "use strict";
            /*** REGION 1 - Global variables - Vùng khai báo biến, hằng So, tham So TOÀN CỤC */

            const gBASE_URL = "http://203.171.20.210:8080/devcamp-pizza365/orders";

            const gODER_COLS = ["orderCode", "kichCo", "loaiPizza", "idLoaiNuocUong", "giamGia", "hoTen", "soDienThoai", "trangThai"]
            var gOrderObj = [];
            var gOrderCode;
            var gOrderId;
            var gPizzaSize = [
                {
                    kichCo: "S",
                    duongKinh: "20 cm",
                    suon: "2",
                    salad: "200",
                    soLuongNuoc: "2",
                    thanhTien: 150000,
                },
                {
                    kichCo: "M",
                    duongKinh: "25 cm",
                    suon: "4",
                    salad: "300",
                    soLuongNuoc: "3",
                    thanhTien: 200000,
                },
                {
                    kichCo: "L",
                    duongKinh: "30 cm",
                    suon: "8",
                    salad: "500",
                    soLuongNuoc: "4",
                    thanhTien: 250000,
                },

            ]
            var gDrinksObj;

            const gCOL_ORDER_CORDE = 0;
            const gCOL_KICH_CO_COMBO = 1;
            const gCOL_LOAI_PIZZA = 2;
            const gCOL_NUOC_UONG = 3;
            const gCOL_THANH_TIEN = 4;
            const gCOL_HO_VA_TEN = 5;
            const gCOL_SO_DIEN_THOAI = 6;
            const gCOL_TRANG_THAI = 7;
            const gCOL_CHI_TIET = 8;

            var gOrderTable = $("#table-order").DataTable({
                columns: [
                    { data: gODER_COLS[gCOL_ORDER_CORDE] },
                    { data: gODER_COLS[gCOL_KICH_CO_COMBO] },
                    { data: gODER_COLS[gCOL_LOAI_PIZZA] },
                    { data: gODER_COLS[gCOL_NUOC_UONG] },
                    { data: gODER_COLS[gCOL_THANH_TIEN] },
                    { data: gODER_COLS[gCOL_HO_VA_TEN] },
                    { data: gODER_COLS[gCOL_SO_DIEN_THOAI] },
                    { data: gODER_COLS[gCOL_TRANG_THAI] },
                    { data: gODER_COLS[gCOL_CHI_TIET] },
                ],
                columnDefs: [
                    {
                        targets: gCOL_CHI_TIET,
                        className: "text-center",
                        defaultContent:
                            `<i  id="btn-detail" class="fas fa-info-circle fa-lg" style="color: blue;"></i> &nbsp;
                        <i id="btn-edit" class="fas fa-edit fa-lg" style="color: green;"></i> &nbsp;                       
                        <i  id="btn-delete" class="fas fa-trash fa-lg" style="color: red;"></i>`
                    },
                    {
                        targets: gCOL_KICH_CO_COMBO,
                        className: "text-center",
                    },
                    {
                        targets: gCOL_NUOC_UONG,
                        className: "text-center",
                    },
                    {
                        targets: gCOL_LOAI_PIZZA,
                        className: "text-center",
                    },
                    {
                        targets: gCOL_THANH_TIEN,
                        className: "text-right",
                    },
                    {
                        targets: gCOL_THANH_TIEN,
                        render: function (data) {
                            var vThanhTien = getThanhTienByGiamGia(data)
                            return vThanhTien;
                        }
                    }


                ]
            })


            /*** REGION 2 - Vùng gán / thực thi sự kiện cho các elements */

            onPageLoading();

            $("#btn-add").on("click", function () {
                onBtnAddNewOrderClick();
            });

            $("#btn-modal-add-order").on("click", function () {
                onBtnAddOrderClick();
            });

            $("#table-order").on("click", "#btn-detail", function () {
                onBtnDetailClick(this);
            });


            $("#table-order").on("click", "#btn-edit", function () {
                onBtnUpdateClick(this);
            });

            $("#btn-modal-confirm-order").on("click", function () {
                onBtnConfirmOrderClick(this);
            });
            $("#btn-modal-cancel").on("click", function () {
                onBtnCancelOrderClick(this);
            });


            $("#table-order").on("click", "#btn-delete", function () {
                onBtnDeleteOrderClick(this);
            })

            $("#btn-confirm-delete-order").on("click", function () {
                onBtnConfirmDeleteOrderClick();
            });

            $("#btn-filter-order").on("click", function () {
                onBtnFilterClick();
            })

            /*** REGION 3 - Event handlers - Vùng khai báo các hàm xử lý sự kiện */
            // Hàm thực hiện khi load trang
            function onPageLoading() {
                getAllOrdersList();
                loadOrderToTable(gOrderObj);
            }

            function onBtnAddNewOrderClick() {

                getDrinkData();
                $("#modal-add-order").modal("show");
                $("#select-size-add").on("change", function () {
                    onSelectDiameterChange();
                });

            }

            function onBtnAddOrderClick() {

                var vObjectRequest = {
                    kichCo: "",
                    duongKinh: "",
                    suon: "",
                    salad: "",
                    loaiPizza: "",
                    idVourcher: 0,
                    idLoaiNuocUong: "",
                    soLuongNuoc: "",
                    hoTen: "",
                    thanhTien: 0,
                    email: "",
                    soDienThoai: "",
                    diaChi: "",
                    loiNhan: ""
                }

                getDataOder(vObjectRequest);
                console.log(vObjectRequest)

                var vValidate = validateDataObject(vObjectRequest);

                if (vValidate) {
                    createOrder(vObjectRequest);

                    getAllOrdersList();
                    loadOrderToTable(gOrderObj);
                    $("#modal-add-order").modal("hide");
                }
            }

            function onBtnDetailClick(paramButton) {
                //xac định thẻ tr là cha của nút được Chon
                var vRowSelected = $(paramButton).parents('tr');
                //Lấy datatable row
                var vDatatableRow = gOrderTable.row(vRowSelected);
                //Lấy data của dòng 
                var vOrderData = vDatatableRow.data();
                gOrderCode = vOrderData.orderCode;
                console.log("Order code: " + gOrderCode);
                gOrderId = vOrderData.id;
                showDataToModalDetail(vOrderData);

                $("#modal-detail-order").modal("show")
            }

            function onBtnUpdateClick(paramButton) {
                //xac định thẻ tr là cha của nút được Chon
                var vRowSelected = $(paramButton).parents('tr');
                //Lấy datatable row
                var vDatatableRow = gOrderTable.row(vRowSelected);
                //Lấy data của dòng 
                var vOrderData = vDatatableRow.data();
                gOrderCode = vOrderData.orderCode;
                console.log("Order code: " + gOrderCode);
                gOrderId = vOrderData.id;
                showDataToModalUpdate(vOrderData);
                $("#modal-edit-order").modal("show")
            }

            function onBtnConfirmOrderClick() {
                // khai báo đối tượng chứa dữ liệu
                var vObjectRequest = {
                    trangThai: "confirmed" //3 Trang Thai: open, confirmed, cancel
                }
                // B1: thu thập dữ liệu (trên querystring)
                console.log("OrderId:  " + gOrderId);
                // B2: validate dữ liệu
                if (gOrderId !== null) {
                    //B3: Gọi API
                    $.ajax({
                        async: false,
                        url: gBASE_URL + "/" + gOrderId,
                        type: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(vObjectRequest),
                        success: function (res) {
                            console.log(res)
                            alert("Don Hang Da xac nhan")
                        },
                        error: function (ajaxContext) {
                            alert(ajaxContext.responseText)
                        }
                    });
                    //B4: hiển thị dữ liệu
                    getAllOrdersList();
                }
                loadOrderToTable(gOrderObj)
                $("#modal-edit-order").modal("hide")
            }

            function onBtnCancelOrderClick() {
                // khai báo đối tượng chứa dữ liệu
                var vObjectRequest = {
                    trangThai: "cancel" //3 Trang Thai: open, confirmed, cancel
                }
                // B1: thu thập dữ liệu (trên querystring)
                console.log("OrderId:  " + gOrderId);
                // B2: validate dữ liệu
                if (gOrderId !== null) {
                    //B3: Gọi API
                    $.ajax({
                        async: false,
                        url: gBASE_URL + "/" + gOrderId,
                        type: "PUT",
                        contentType: "application/json",
                        data: JSON.stringify(vObjectRequest),
                        success: function (res) {
                            console.log(res)
                            alert("Don Hang Da bị Huy")
                        },
                        error: function (ajaxContext) {
                            alert(ajaxContext.responseText)
                        }
                    });
                    //B4: hiển thị dữ liệu
                    getAllOrdersList();
                }
                loadOrderToTable(gOrderObj)
                $("#modal-edit-order").modal("hide")
            }


            function onBtnDeleteOrderClick(paramButton) {
                //xac định thẻ tr là cha của nút được Chon
                var vRowSelected = $(paramButton).parents('tr');
                //Lấy datatable row
                var vDatatableRow = gOrderTable.row(vRowSelected);
                //Lấy data của dòng 
                var vOrderData = vDatatableRow.data();
                gOrderId = vOrderData.id;
                console.log("OrderId: " + gOrderId);

                $("#delete-confirm-modal").modal("show");
            }

            function onBtnConfirmDeleteOrderClick() {
                // khai báo đối tượng chứa voucher data
                // B1: Thu thập dữ liệu
                // B2: Validate update
                // B3: delete voucher
                deleteOrder(gOrderId);
                //B4: hiển thị dữ liệu
                getAllOrdersList();

                loadOrderToTable(gOrderObj)

                $("#delete-confirm-modal").modal("hide");
            }
            // Hàm xử lý khi click nút lọc dữ liệu
            function onBtnFilterClick() {
                "use strict";
                // Bước 0: Tao đối tượng chứa điều kiện lọc
                var vFilter = {
                    typePizza: "",
                    status: "",
                }
                // Bước 1: Thu thập dữ liệu lọc
                getDataFromSelect(vFilter);
                console.log(vFilter);
                // Bước 2: Kiểm tra - bỏ qua
                // Bước 3: Lọc dữ liệu
                var vResultFilter = filterData(vFilter);
                console.log(vResultFilter);
                // // Bước 4: Hiển thị kết quả lọc ra datatable
                displayDataToTable(vResultFilter);
            }

            /*** REGION 4 - Common funtions - Vùng khai báo hàm dùng chung trong toàn bộ chương trình*/
            // Hàm thực hiện việc load all orders từ server va load vao table

            // hàm gọi api để lấy all orders
            function getAllOrdersList() {
                "use strict";
                //base url
                const vBASE_URL = "http://203.171.20.210:8080/devcamp-pizza365/orders";
                $.ajax({
                    async: false,
                    url: vBASE_URL,
                    type: 'GET',
                    success: function (res) {
                        gOrderObj = res;
                    },
                    error: function (ajaxContext) {
                        alert(ajaxContext.responseText)
                    }
                })
            }

            // input: xml http request Da đươc trả Loi
            // ouptut/end: dữ liệu hiên thi trên bảng
            function loadOrderToTable(paramData) {
                var vTable = $('#table-order').DataTable(); // Truy xuất datatable
                vTable.clear(); // Xóa dữ liệu của datatable
                vTable.rows.add(paramData); // Thêm các dòng dữ liệu vao datatable
                vTable.draw();
            }

            function showDataToModalDetail(paramData) {
                $("#input-detail-order-code").val(paramData.orderCode);
                $("#input-detail-combo").val(paramData.kichCo);
                $("#input-detail-duong-kinh").val(paramData.duongKinh);
                $("#input-detail-suon-nuong").val(paramData.suon);
                $("#input-detail-drink").val(paramData.idLoaiNuocUong);
                $("#input-detail-drink-number").val(paramData.soLuongNuoc);
                $("#input-detail-voucher").val(paramData.idVourcher);
                $("#input-detail-type-pizza").val(paramData.loaiPizza);
                $("#input-detail-salad").val(paramData.salad);
                $("#input-detail-money").val(paramData.thanhTien);
                $("#input-detail-discoun").val(paramData.giamGia);
                $("#input-detail-full-name").val(paramData.hoTen);
                $("#input-detail-email").val(paramData.email);
                $("#input-detail-mobile").val(paramData.soDienThoai)
                $("#input-detail-address").val(paramData.diaChi);
                $("#input-detail-messeage").val(paramData.loiNhan);
                $("#input-detail-date-create").val(paramData.ngayTao);
                $("#input-detail-date-update").val(paramData.ngayCapNhat);
            };
            function showDataToModalUpdate(paramData) {
                $("#input-order-code").val(paramData.orderCode);
                $("#input-combo").val(paramData.kichCo);
                $("#input-duong-kinh").val(paramData.duongKinh);
                $("#input-suon-nuong").val(paramData.suon);
                $("#input-drink").val(paramData.idLoaiNuocUong);
                $("#input-drink-number").val(paramData.soLuongNuoc);
                $("#input-voucher").val(paramData.idVourcher);
                $("#input-type-pizza").val(paramData.loaiPizza);
                $("#input-salad").val(paramData.salad);
                $("#input-money").val(paramData.thanhTien);
                $("#input-discoun").val(paramData.giamGia);
                $("#input-full-name").val(paramData.hoTen);
                $("#input-email").val(paramData.email);
                $("#input-mobile").val(paramData.soDienThoai)
                $("#input-address").val(paramData.diaChi);
                $("#input-messeage").val(paramData.loiNhan);
                $("#input-date-create").val(paramData.ngayTao);
                $("#input-date-update").val(paramData.ngayCapNhat);
            };

            // hàm trả về So tien oHai thanh toán dựa vao So tien được Giam gia
            function getThanhTienByGiamGia(paramDiscount) {
                "use strict";
                var vThanhTien = "";
                var vIndex = 0;
                var vIsPhaiTraFound = false;
                while (!vIsPhaiTraFound && vIndex < gOrderObj.length) {
                    if (gOrderObj[vIndex].giamGia === paramDiscount) {
                        vIsPhaiTraFound = true;
                        vThanhTien = gOrderObj[vIndex].thanhTien - gOrderObj[vIndex].giamGia;
                    }
                    else {
                        vIndex++;
                    }
                }
                return vThanhTien;
            }

            function onSelectDiameterChange() {
                var vPizzaSize = $("#select-size-add option:selected").text();
                console.log("PizzaSize: " + vPizzaSize)
                //load dữ liệu ra Duong Kinh select
                loadDataToDiameterSelect(vPizzaSize);
                loadDataToRibsSelect(vPizzaSize);
                loadDataToSaladSelect(vPizzaSize);
                loadDataToDrinkSelet(vPizzaSize);
                loadDataToPriceSelect(vPizzaSize);
            }

            function getDiameterByPizzaSize(paramPizzaSize) {
                var vDiameterFound = false;
                var vDiameterResult = null;
                var vIterator = 0;
                while (!vDiameterFound && vIterator < gPizzaSize.length) {
                    if (gPizzaSize[vIterator].kichCo === paramPizzaSize) {
                        vDiameterFound = true;
                        vDiameterResult = gPizzaSize[vIterator].duongKinh;
                    }
                    else {
                        vIterator++;
                    }
                }
                return vDiameterResult;
            }

            function loadDataToDiameterSelect(paramPizzaSize) {
                var vDiameter = getDiameterByPizzaSize(paramPizzaSize);
                var vDiameterSelect = $("#select-diameter-add");
                vDiameterSelect.html("--Chon--");
                $("<option/>", {
                    "text": vDiameter
                }).appendTo(vDiameterSelect);
            }

            function getRibsByPizzaSize(paramPizzaSize) {
                var vRibsFound = false;
                var vRibsResult = null;
                var vIterator = 0;
                while (!vRibsFound && vIterator < gPizzaSize.length) {
                    if (gPizzaSize[vIterator].kichCo === paramPizzaSize) {
                        vRibsFound = true;
                        vRibsResult = gPizzaSize[vIterator].suon;
                    }
                    else {
                        vIterator++;
                    }
                }
                return vRibsResult;
            }

            function loadDataToRibsSelect(paramPizzaSize) {
                var vRibs = getRibsByPizzaSize(paramPizzaSize);
                var vRibsSelect = $("#select-suon-add");
                vRibsSelect.html("--Chon--");
                $("<option/>", {
                    "text": vRibs
                }).appendTo(vRibsSelect);
            }

            function getSaladByPizzaSize(paramPizzaSize) {
                var vSaladFound = false;
                var vSaladResult = null;
                var vIterator = 0;
                while (!vSaladFound && vIterator < gPizzaSize.length) {
                    if (gPizzaSize[vIterator].kichCo === paramPizzaSize) {
                        vSaladFound = true;
                        vSaladResult = gPizzaSize[vIterator].salad;
                    }
                    else {
                        vIterator++;
                    }
                }
                return vSaladResult;
            }

            function loadDataToSaladSelect(paramPizzaSize) {
                var vSalad = getSaladByPizzaSize(paramPizzaSize);
                var vSaladSelect = $("#select-salad-add");
                vSaladSelect.html("--Chon--");
                $("<option/>", {
                    "text": vSalad
                }).appendTo(vSaladSelect);
            }

            function getDrinkByPizzaSize(paramPizzaSize) {
                var vWaterFound = false;
                var vWaterResult = null;
                var vIterator = 0;
                while (!vWaterFound && vIterator < gPizzaSize.length) {
                    if (gPizzaSize[vIterator].kichCo === paramPizzaSize) {
                        vWaterFound = true;
                        vWaterResult = gPizzaSize[vIterator].soLuongNuoc;
                    }
                    else {
                        vIterator++;
                    }
                }
                return vWaterResult;
            }

            function loadDataToDrinkSelet(paramPizzaSize) {
                var vWater = getDrinkByPizzaSize(paramPizzaSize);
                var vWaterSelect = $("#select-water-add");
                vWaterSelect.html("--Chon--");
                $("<option/>", {
                    "text": vWater
                }).appendTo(vWaterSelect);
            }

            function getPriceByPizzaSize(paramPizzaSize) {
                var vPriceFound = false;
                var vPriceResult = null;
                var vIterator = 0;
                while (!vPriceFound && vIterator < gPizzaSize.length) {
                    if (gPizzaSize[vIterator].kichCo === paramPizzaSize) {
                        vPriceFound = true;
                        vPriceResult = gPizzaSize[vIterator].thanhTien;
                    }
                    else {
                        vIterator++;
                    }
                }
                return vPriceResult;
            }

            function loadDataToPriceSelect(paramPizzaSize) {
                var vPrice = getPriceByPizzaSize(paramPizzaSize);
                var vPriceSelect = $("#select-price-add");
                vPriceSelect.html("--Chon--");
                $("<option/>", {
                    "text": vPrice
                }).appendTo(vPriceSelect);
            }

            //mã nguồn để load data do Uong về
            function getDrinkData() {
                $.ajax({
                    async: false,
                    url: "http://203.171.20.210:8080/devcamp-pizza365/drinks",
                    type: "GET",
                    dataType: 'json',
                    success: function (responseObject) {
                        console.log(responseObject);
                        gDrinksObj = responseObject;
                    },
                    error: function (error) {
                        console.assert(error.responseText);
                    }
                });
                loadDataToDrinksSelect(gDrinksObj)
            }

            // hàm thực hiện việc load dữ liệu vao Select do Uong
            function loadDataToDrinksSelect(paramData) {
                var vSelectDrinksElement = $("#select-type-water-add");
                for (var bIterator = 0; bIterator < paramData.length; bIterator++) {
                    // Tao option mới
                    var bDrinksOptionElement = $("<option>", {
                        value: paramData[bIterator].maNuocUong,
                        text: paramData[bIterator].tenNuocUong
                    });
                    // thêm vao select html element
                    vSelectDrinksElement.append(bDrinksOptionElement);
                }
            }

            function getDataOder(paramData) {
                paramData.kichCo = $("#select-size-add option:selected").text();
                paramData.duongKinh = $("#select-diameter-add").val();
                paramData.suon = $("#select-suon-add").val();
                paramData.salad = $("#select-salad-add").val();
                paramData.soLuongNuoc = $("#select-water-add").val();
                paramData.thanhTien = $("#select-price-add").val();
                paramData.loaiPizza = $("#select-type-add option:selected").text();
                paramData.idVourcher = $("#input-voucher-add").val();
                paramData.idLoaiNuocUong = $("#select-type-water-add option:selected").text();
                paramData.hoTen = $("#input-fullname-add").val();
                paramData.email = $("#input-email-add").val();
                paramData.soDienThoai = $("#input-mobile-add").val();
                paramData.diaChi = $("#input-address-add").val();
                paramData.loiNhan = $("#input-messeage-add").val();
                paramData.trangThai = $("#select-status-add").val();
            }

            // Hàm kiểm tra email
            function validateEmail(paramEmail) {
                var vValidRegex =
                    /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                if (paramEmail.match(vValidRegex)) {
                    return true;
                } else {
                    return false;
                }
            }

            function validateDataObject(paramData) {
                if (paramData.kichCo == "--Chon size--") {
                    alert("chưa Chon Kick co ");
                    return false;
                }
                if (paramData.loaiPizza == "--Chon Loai Pizza--") {
                    alert("chưa Chon Loai pizza  ");
                    return false;
                }
                if (paramData.idLoaiNuocUong == "--Chon Loai Nuoc Uong--") {
                    alert("chưa Chon Nuoc Uong  ");
                    return false;
                }
                if (paramData.hoTen == "") {
                    alert("chưa nhập Ho ten ");
                    return false;
                }
                if (validateEmail(paramData.email) == false) {
                    alert("Email pHai có dạng abc@xyz.com ");
                    return false;
                }
                if (paramData.soDienThoai == "") {
                    alert("chưa nhập So dien thoai ");
                    return false;
                }
                if (paramData.diaChi == "") {
                    alert("chưa nhập Dia Chi  ");
                    return false;
                }
                return true;
            }

            //gọi Tao một order mới
            function createOrder(paramData) {
                "use strict";
                $.ajax({
                    async: false,
                    url: "http://203.171.20.210:8080/devcamp-pizza365/orders",
                    type: "POST",
                    data: JSON.stringify(paramData),
                    contentType: "application/json",
                    success: function (responseObject) {
                        console.log(responseObject);
                        alert("Thêm order Thanh công")
                    },
                    error: function (error) {
                        console.assert(error.responseText);
                    }
                });

            }


            // hàm xóa Order theo id order
            function deleteOrder(paramData) {
                "use strict";
                $.ajax({
                    async: false,
                    url: gBASE_URL + "/" + gOrderId,
                    type: "DELETE",
                    success: function (paramDataRequest) {
                        console.log(paramDataRequest);
                        alert("Order Da bị xoá!");
                    },
                    error: function (ajaxContext) {
                        alert(ajaxContext.responseText)
                    }
                });
            }

            // Hàm thu thập dữ liệu lọc order
            // Input là đối tượng chứa dữ liệu lọc
            function getDataFromSelect(paramData) {
                "use strict";
                paramData.typePizza = $("#select-type-pizza").val();
                paramData.status = $("#select-status").val();
            }

            // Hàm lọc dữ liệu
            // Input là điều kiện lọc
            // Output là kết quả lọc
            function filterData(paramFilter) {
                "use strict";

                var vResult = [];
                vResult = gOrderObj.filter(function (item) {
                    return (item.loaiPizza == paramFilter.typePizza && item.trangThai == paramFilter.status ||
                        item.loaiPizza == paramFilter.typePizza && paramFilter.typePizza == 0 || item.trangThai == paramFilter.status && paramFilter.status == 0);
                })
                return vResult;
            }

            function displayDataToTable(paramData) {
                "use strict";
                var vTable = $('#table-order').DataTable(); // Truy xuất datatable
                vTable.clear(); // Xóa dữ liệu của datatable
                vTable.rows.add(paramData); // Thêm các dòng dữ liệu vao datatable
                vTable.draw();
            }

        </script>
</body>

</html>